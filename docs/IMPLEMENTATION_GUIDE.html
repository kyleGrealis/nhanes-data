<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NHANES Data Automation - Implementation Guide â€¢ nhanesdata</title><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="NHANES Data Automation - Implementation Guide"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">nhanesdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started with NHANES Data</a></li>
    <li><a class="dropdown-item" href="articles/introduction.html">Introduction to nhanesdata</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kyleGrealis/nhanesdata" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NHANES Data Automation - Implementation Guide</h1>

    </div>

<div id="nhanes-data-automation---implementation-guide" class="section level1">

<div class="section level2">
<h2 id="tada-implementation-complete">ğŸ‰ Implementation Complete!<a class="anchor" aria-label="anchor" href="#tada-implementation-complete"></a></h2>
<p>This document summarizes the automated NHANES data pipeline implementation with all requested features.</p>
</div>
<div class="section level2">
<h2 id="package-core-features-implemented">ğŸ“¦ Core Features Implemented<a class="anchor" aria-label="anchor" href="#package-core-features-implemented"></a></h2>
<div class="section level3">
<h3 id="id_1-github-actions-workflow-githubworkflowsupdate-nhanes-datayml">1. <strong>GitHub Actions Workflow</strong> (<code>.github/workflows/update-nhanes-data.yml</code>)<a class="anchor" aria-label="anchor" href="#id_1-github-actions-workflow-githubworkflowsupdate-nhanes-datayml"></a></h3>
<ul><li>âœ… Quarterly automated runs (Jan 1, Apr 1, Jul 1, Oct 1 at 2 AM UTC)</li>
<li>âœ… Manual trigger support with options for:
<ul><li>Specific dataset selection</li>
<li>Dry-run mode (testing without R2 upload)</li>
</ul></li>
<li>âœ… Secure credential handling via GitHub Secrets</li>
<li>âœ… Automatic checksum updates committed to repo</li>
<li>âœ… Workflow summary artifacts and release notes</li>
</ul></div>
<div class="section level3">
<h3 id="id_2-change-detection-system-rdatar">2. <strong>Change Detection System</strong> (<code>R/data.R</code>)<a class="anchor" aria-label="anchor" href="#id_2-change-detection-system-rdatar"></a></h3>
<ul><li>âœ… <code>detect_data_changes()</code> - MD5 checksum comparison</li>
<li>âœ… <code>update_checksum()</code> - Update hash tracking file</li>
<li>âœ… <code>load_dataset_config()</code> - Read YAML configuration</li>
<li>âœ… <code>.checksums.json</code> - Git-tracked version control</li>
</ul></div>
<div class="section level3">
<h3 id="id_3-dataset-configuration-instextdatadatasetsyml">3. <strong>Dataset Configuration</strong> (<code>inst/extdata/datasets.yml</code>)<a class="anchor" aria-label="anchor" href="#id_3-dataset-configuration-instextdatadatasetsyml"></a></h3>
<ul><li>âœ… All <strong>66 NHANES datasets</strong> catalogued</li>
<li>âœ… Organized by category (questionnaire/examination)</li>
<li>âœ… Includes descriptions and special notes</li>
<li>âœ… Easily extensible for future datasets</li>
</ul></div>
<div class="section level3">
<h3 id="id_4-workflow-orchestration-instscriptsworkflow_updater">4. <strong>Workflow Orchestration</strong> (<code>inst/scripts/workflow_update.R</code>)<a class="anchor" aria-label="anchor" href="#id_4-workflow-orchestration-instscriptsworkflow_updater"></a></h3>
<ul><li>âœ… Pulls data from CDC servers</li>
<li>âœ… Detects changes via checksums</li>
<li>âœ… Uploads only modified datasets to R2</li>
<li>âœ… Generates JSON summary report</li>
<li>âœ… Supports dry-run and dataset filtering</li>
</ul></div>
<div class="section level3">
<h3 id="id_5-security-documentation-securitymd">5. <strong>Security Documentation</strong> (<code>SECURITY.md</code>)<a class="anchor" aria-label="anchor" href="#id_5-security-documentation-securitymd"></a></h3>
<ul><li>âœ… Step-by-step R2 API token creation</li>
<li>âœ… GitHub Secrets configuration guide</li>
<li>âœ… Security best practices</li>
<li>âœ… Token rotation schedule</li>
<li>âœ… Incident response procedures</li>
</ul></div>
<div class="section level3">
<h3 id="id_6-enhanced-readme">6. <strong>Enhanced README</strong>
<a class="anchor" aria-label="anchor" href="#id_6-enhanced-readme"></a></h3>
<ul><li>âœ… Clear explanation of CDC cycle suffixes vs base names</li>
<li>âœ… Tidyverse-style code examples (<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code>)</li>
<li>âœ… Automated pipeline documentation</li>
<li>âœ… Manual trigger instructions</li>
<li>âœ… All 66 datasets listed</li>
<li>âœ… Usage examples for common workflows</li>
</ul></div>
<div class="section level3">
<h3 id="id_7-bug-fixes">7. <strong>Bug Fixes</strong>
<a class="anchor" aria-label="anchor" href="#id_7-bug-fixes"></a></h3>
<ul><li>âœ… Implemented missing <code>drop_label_kyle()</code> function</li>
<li>âœ… Added proper roxygen2 documentation</li>
<li>âœ… Updated NAMESPACE exports</li>
</ul></div>
<div class="section level3">
<h3 id="id_8-updated-dependencies-description">8. <strong>Updated Dependencies</strong> (<code>DESCRIPTION</code>)<a class="anchor" aria-label="anchor" href="#id_8-updated-dependencies-description"></a></h3>
<ul><li>âœ… Added <code>jsonlite</code> for checksum storage</li>
<li>âœ… Added <code>yaml</code> for config parsing</li>
<li>âœ… Added <code>tibble</code> for data structures</li>
<li>âœ… Added <code>purrr</code> to Suggests for README examples</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="closed_lock_with_key-next-steps-manual-actions-required">ğŸ” Next Steps (Manual Actions Required)<a class="anchor" aria-label="anchor" href="#closed_lock_with_key-next-steps-manual-actions-required"></a></h2>
<p>Youâ€™ll need to complete these steps to activate the automation:</p>
<div class="section level3">
<h3 id="id_1-create-cloudflare-r2-api-token">1. Create Cloudflare R2 API Token<a class="anchor" aria-label="anchor" href="#id_1-create-cloudflare-r2-api-token"></a></h3>
<ol style="list-style-type: decimal"><li>Log in to <a href="https://dash.cloudflare.com/" class="external-link">Cloudflare Dashboard</a>
</li>
<li>Navigate to <strong>R2</strong> â†’ <strong>Manage R2 API Tokens</strong>
</li>
<li>Click <strong>Create API Token</strong>
</li>
<li>Configure:
<ul><li>
<strong>Name:</strong> <code>nhanes-data-workflow</code>
</li>
<li>
<strong>Permissions:</strong> Object Read &amp; Write</li>
<li>
<strong>Bucket scope:</strong> <code>nhanes-data</code> (specific bucket only)</li>
<li>
<strong>TTL:</strong> 1 year (set reminder to rotate)</li>
</ul></li>
<li>
<strong>CRITICAL:</strong> Copy these values immediately (shown only once!):
<ul><li>Access Key ID</li>
<li>Secret Access Key</li>
<li>Account ID (also in dashboard URL)</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="id_2-add-github-secrets">2. Add GitHub Secrets<a class="anchor" aria-label="anchor" href="#id_2-add-github-secrets"></a></h3>
<ol style="list-style-type: decimal"><li>Go to your GitHub repository: <code>https://github.com/kyleGrealis/nhanesdata</code>
</li>
<li>Navigate to <strong>Settings</strong> â†’ <strong>Secrets and variables</strong> â†’ <strong>Actions</strong>
</li>
<li>Click <strong>New repository secret</strong> and add each:</li>
</ol><table class="table"><colgroup><col width="44%"><col width="25%"><col width="29%"></colgroup><thead><tr><th>Secret Name</th>
<th>Value</th>
<th>Source</th>
</tr></thead><tbody><tr><td><code>R2_ACCOUNT_ID</code></td>
<td>Your Cloudflare Account ID</td>
<td>Dashboard URL or R2 settings</td>
</tr><tr><td><code>R2_ACCESS_KEY_ID</code></td>
<td>Access Key ID from Step 1</td>
<td>API token creation</td>
</tr><tr><td><code>R2_SECRET_ACCESS_KEY</code></td>
<td>Secret Access Key from Step 1</td>
<td>API token creation</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_3-enable-github-actions-permissions">3. Enable GitHub Actions Permissions<a class="anchor" aria-label="anchor" href="#id_3-enable-github-actions-permissions"></a></h3>
<ol style="list-style-type: decimal"><li>Go to <strong>Settings</strong> â†’ <strong>Actions</strong> â†’ <strong>General</strong>
</li>
<li>Under <strong>Workflow permissions</strong>, select:
<ul><li>âœ… â€œRead and write permissionsâ€</li>
<li>âœ… â€œAllow GitHub Actions to create and approve pull requestsâ€</li>
</ul></li>
<li>Click <strong>Save</strong>
</li>
</ol></div>
<div class="section level3">
<h3 id="id_4-test-the-workflow">4. Test the Workflow<a class="anchor" aria-label="anchor" href="#id_4-test-the-workflow"></a></h3>
<p><strong>Option A: Via GitHub UI</strong> 1. Go to <strong>Actions</strong> tab 2. Select <strong>Update NHANES Data</strong> workflow 3. Click <strong>Run workflow</strong> 4. Set options: - Datasets: <code>demo</code> (single dataset for testing) - Dry run: âœ… (check the box) 5. Click <strong>Run workflow</strong> 6. Wait for completion and check the <strong>workflow_summary.json</strong> artifact</p>
<p><strong>Option B: Via GitHub CLI</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Test with dry run (no R2 upload)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">gh</span> workflow run update-nhanes-data.yml <span class="at">-f</span> dry_run=true <span class="at">-f</span> datasets=<span class="st">"demo"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Check workflow status</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">gh</span> run list <span class="at">--workflow</span><span class="op">=</span>update-nhanes-data.yml</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># View workflow logs</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="ex">gh</span> run view <span class="at">--log</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_5-production-run-optional">5. Production Run (Optional)<a class="anchor" aria-label="anchor" href="#id_5-production-run-optional"></a></h3>
<p>Once the dry run succeeds, test a real upload:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Upload single dataset to R2</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">gh</span> workflow run update-nhanes-data.yml <span class="at">-f</span> datasets=<span class="st">"demo"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Check that demo.parquet appears at https://nhanes.kylegrealis.com/demo.parquet</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="file_folder-files-createdmodified">ğŸ“ Files Created/Modified<a class="anchor" aria-label="anchor" href="#file_folder-files-createdmodified"></a></h2>
<div class="section level3">
<h3 id="new-files-created">New Files Created<a class="anchor" aria-label="anchor" href="#new-files-created"></a></h3>
<pre><code>.github/workflows/
â””â”€â”€ update-nhanes-data.yml          # GitHub Actions workflow

inst/extdata/
â””â”€â”€ datasets.yml                     # 66 dataset configuration

inst/scripts/
â””â”€â”€ workflow_update.R                # Orchestration script

man/
â”œâ”€â”€ detect_data_changes.Rd           # Function documentation
â”œâ”€â”€ update_checksum.Rd               # Function documentation
â””â”€â”€ load_dataset_config.Rd           # Function documentation

SECURITY.md                          # R2 setup &amp; security guide
IMPLEMENTATION_GUIDE.md              # This file
.checksums.json                      # MD5 hash tracking (git-tracked)</code></pre>
</div>
<div class="section level3">
<h3 id="modified-files">Modified Files<a class="anchor" aria-label="anchor" href="#modified-files"></a></h3>
<pre><code>R/
â”œâ”€â”€ data.R                           # Added 3 new functions
â””â”€â”€ custom_functions.R               # Implemented drop_label_kyle()

DESCRIPTION                          # Added dependencies
NAMESPACE                            # Updated exports
README.md                            # Complete rewrite
man/drop_label_kyle.Rd               # Fixed documentation</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="dart-how-it-works">ğŸ¯ How It Works<a class="anchor" aria-label="anchor" href="#dart-how-it-works"></a></h2>
<div class="section level3">
<h3 id="automated-quarterly-pipeline">Automated Quarterly Pipeline<a class="anchor" aria-label="anchor" href="#automated-quarterly-pipeline"></a></h3>
<pre class="mermaid"><code>graph LR
    A[Quarterly Cron] --&gt; B[Checkout Repo]
    B --&gt; C[Setup R Environment]
    C --&gt; D[Install nhanesdata]
    D --&gt; E[Load Config: 66 Datasets]
    E --&gt; F[Pull from CDC Servers]
    F --&gt; G[Calculate MD5 Checksums]
    G --&gt; H{Data Changed?}
    H --&gt;|Yes| I[Upload to R2]
    H --&gt;|No| J[Skip Upload]
    I --&gt; K[Update .checksums.json]
    J --&gt; K
    K --&gt; L[Commit Checksums]
    L --&gt; M[Create Release Notes]</code></pre>
</div>
<div class="section level3">
<h3 id="step-by-step-process">Step-by-Step Process<a class="anchor" aria-label="anchor" href="#step-by-step-process"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>GitHub Actions Trigger</strong>
<ul><li>Cron: <code>0 2 1 1,4,7,10 *</code> (quarterly)</li>
<li>Manual: <code>workflow_dispatch</code> event</li>
</ul></li>
<li>
<strong>Environment Setup</strong>
<ul><li>Ubuntu runner</li>
<li>R release version</li>
<li>Install package dependencies</li>
</ul></li>
<li>
<strong>Data Acquisition</strong>
<ul><li>Load <code>inst/extdata/datasets.yml</code>
</li>
<li>For each dataset:
<ul><li>Call <code>pull_nhanes(dataset_name)</code>
</li>
<li>Merges all CDC cycles (e.g., DEMO, DEMO_B, â€¦, DEMO_L)</li>
<li>Saves to <code>data/raw/parquet/demo.parquet</code>
</li>
</ul></li>
</ul></li>
<li>
<strong>Change Detection</strong>
<ul><li>Calculate MD5 hash of parquet file</li>
<li>Compare with <code>.checksums.json</code>
</li>
<li>Log: NEW, CHANGED, or UNCHANGED</li>
</ul></li>
<li>
<strong>R2 Upload (if changed)</strong>
<ul><li>Call <code>nhanes_pin_write(data, name, bucket='nhanes-data')</code>
</li>
<li>Uses S3-compatible API with pins package</li>
<li>Versioned storage on Cloudflare R2</li>
</ul></li>
<li>
<strong>Checksum Update</strong>
<ul><li>Update <code>.checksums.json</code> with new hash</li>
<li>Commit to git with automated message</li>
</ul></li>
<li>
<strong>Summary Report</strong>
<ul><li>Generate <code>workflow_summary.json</code>
</li>
<li>Upload as GitHub artifact (90-day retention)</li>
<li>Create release notes artifact</li>
</ul></li>
</ol><hr></div>
</div>
<div class="section level2">
<h2 id="lock-security-model">ğŸ”’ Security Model<a class="anchor" aria-label="anchor" href="#lock-security-model"></a></h2>
<div class="section level3">
<h3 id="public-read--private-write-architecture">Public Read / Private Write Architecture<a class="anchor" aria-label="anchor" href="#public-read--private-write-architecture"></a></h3>
<p>This implements the industry-standard security model used by CRAN, Bioconductor, and AWS Open Data Registry.</p>
<p><strong>Tier 1: Public Data Access (Users)</strong> - <strong>Method:</strong> HTTPS GET to <code>https://nhanes.kylegrealis.com/</code> - <strong>Authentication:</strong> None required - <strong>Operations:</strong> Read-only downloads - <strong>Rate Limiting:</strong> Cloudflare CDN handles DDoS protection - <strong>Justification:</strong> NHANES is public health data (U.S. government)</p>
<p><strong>Tier 2: Data Upload (Workflow Only)</strong> - <strong>Method:</strong> S3-compatible API with scoped credentials - <strong>Authentication:</strong> R2 API token (GitHub Secrets) - <strong>Operations:</strong> Write, update, delete - <strong>Scope:</strong> Limited to <code>nhanes-data</code> bucket only - <strong>Permissions:</strong> No account-level or billing access</p>
</div>
<div class="section level3">
<h3 id="why-this-is-secure">Why This Is Secure<a class="anchor" aria-label="anchor" href="#why-this-is-secure"></a></h3>
<p>âœ… <strong>Scoped Token</strong>: Can only write to one bucket (no account access) âœ… <strong>Principle of Least Privilege</strong>: Minimal permissions granted âœ… <strong>GitHub Secrets</strong>: Credentials encrypted at rest âœ… <strong>Audit Trail</strong>: Cloudflare logs all API operations âœ… <strong>Version Control</strong>: <code>.checksums.json</code> tracks all changes âœ… <strong>Workflow Isolation</strong>: Each run is stateless and sandboxed</p>
</div>
<div class="section level3">
<h3 id="token-rotation-schedule">Token Rotation Schedule<a class="anchor" aria-label="anchor" href="#token-rotation-schedule"></a></h3>
<ul><li>
<strong>Frequency:</strong> Annually (set calendar reminder)</li>
<li>
<strong>Process:</strong>
<ol style="list-style-type: decimal"><li>Create new R2 API token with same scope</li>
<li>Update GitHub Secrets</li>
<li>Test with dry run</li>
<li>Revoke old token in Cloudflare dashboard</li>
</ol></li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="bar_chart-dataset-organization">ğŸ“Š Dataset Organization<a class="anchor" aria-label="anchor" href="#bar_chart-dataset-organization"></a></h2>
<div class="section level3">
<h3 id="cdc-naming-convention">CDC Naming Convention<a class="anchor" aria-label="anchor" href="#cdc-naming-convention"></a></h3>
<p>CDC releases NHANES data in 2-year cycles with letter suffixes:</p>
<table class="table"><thead><tr><th>Cycle</th>
<th>Years</th>
<th>Suffix</th>
<th>Example (Demographics)</th>
</tr></thead><tbody><tr><td>1</td>
<td>1999-2000</td>
<td>(none)</td>
<td><code>DEMO</code></td>
</tr><tr><td>2</td>
<td>2001-2002</td>
<td>B</td>
<td><code>DEMO_B</code></td>
</tr><tr><td>3</td>
<td>2003-2004</td>
<td>C</td>
<td><code>DEMO_C</code></td>
</tr><tr><td>4</td>
<td>2005-2006</td>
<td>D</td>
<td><code>DEMO_D</code></td>
</tr><tr><td>5</td>
<td>2007-2008</td>
<td>E</td>
<td><code>DEMO_E</code></td>
</tr><tr><td>6</td>
<td>2009-2010</td>
<td>F</td>
<td><code>DEMO_F</code></td>
</tr><tr><td>7</td>
<td>2011-2012</td>
<td>G</td>
<td><code>DEMO_G</code></td>
</tr><tr><td>8</td>
<td>2013-2014</td>
<td>H</td>
<td><code>DEMO_H</code></td>
</tr><tr><td>9</td>
<td>2015-2016</td>
<td>I</td>
<td><code>DEMO_I</code></td>
</tr><tr><td>10</td>
<td>2017-2018</td>
<td>J</td>
<td><code>DEMO_J</code></td>
</tr><tr><td>(skipped)</td>
<td>2019-2020</td>
<td>K</td>
<td>Not released (COVID-19)</td>
</tr><tr><td>11</td>
<td>2021-2022</td>
<td>L</td>
<td><code>DEMO_L</code></td>
</tr></tbody></table><p><strong>Note:</strong> Letter K is skipped because the 2019-2020 cycle was interrupted by the COVID-19 pandemic.</p>
</div>
<div class="section level3">
<h3 id="our-storage-format">Our Storage Format<a class="anchor" aria-label="anchor" href="#our-storage-format"></a></h3>
<p>We combine all cycles and store by <strong>base name only</strong>:</p>
<pre><code>CDC Server:          Our R2 Bucket:
-----------          --------------
DEMO                 demo.parquet (all cycles merged)
DEMO_B
DEMO_C
...
DEMO_L

BPX                  bpx.parquet (all cycles merged)
BPX_B
BPX_C
...
BPX_L</code></pre>
<p>Each merged dataset includes a <code>year</code> column to track cycle origin.</p>
</div>
<div class="section level3">
<h3 id="all-66-datasets">All 66 Datasets<a class="anchor" aria-label="anchor" href="#all-66-datasets"></a></h3>
<p>See <code>inst/extdata/datasets.yml</code> for the complete list organized by: - <strong>Questionnaire/Interview Tables (50 datasets)</strong> - <strong>Examination Tables (16 datasets)</strong></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="rocket-usage-after-deployment">ğŸš€ Usage After Deployment<a class="anchor" aria-label="anchor" href="#rocket-usage-after-deployment"></a></h2>
<div class="section level3">
<h3 id="for-end-users">For End Users<a class="anchor" aria-label="anchor" href="#for-end-users"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"kyleGrealis/nhanesdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load pre-processed data (no CDC download needed)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">nhanesdata</span><span class="op">)</span></span>
<span><span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_nhanes.html">read_nhanes</a></span><span class="op">(</span><span class="st">'demo'</span><span class="op">)</span></span>
<span><span class="va">bpx</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_nhanes.html">read_nhanes</a></span><span class="op">(</span><span class="st">'bpx'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load multiple datasets with tidyverse style</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'demo'</span>, <span class="st">'bpx'</span>, <span class="st">'bmx'</span>, <span class="st">'trigly'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">read_nhanes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'demo'</span>, <span class="st">'bpx'</span>, <span class="st">'bmx'</span>, <span class="st">'trigly'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="for-maintainers">For Maintainers<a class="anchor" aria-label="anchor" href="#for-maintainers"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Manual workflow trigger (all datasets)</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">gh</span> workflow run update-nhanes-data.yml</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># Update specific datasets only</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="ex">gh</span> workflow run update-nhanes-data.yml <span class="at">-f</span> datasets=<span class="st">"demo,bpx,trigly"</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># Dry run (testing without R2 upload)</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="ex">gh</span> workflow run update-nhanes-data.yml <span class="at">-f</span> dry_run=true</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># Check workflow status</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="ex">gh</span> run list <span class="at">--workflow</span><span class="op">=</span>update-nhanes-data.yml</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co"># View latest run logs</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="ex">gh</span> run view <span class="at">--log</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="bug-troubleshooting">ğŸ› Troubleshooting<a class="anchor" aria-label="anchor" href="#bug-troubleshooting"></a></h2>
<div class="section level3">
<h3 id="workflow-fails-during-data-pull">Workflow Fails During Data Pull<a class="anchor" aria-label="anchor" href="#workflow-fails-during-data-pull"></a></h3>
<p><strong>Symptom:</strong> Dataset download times out or fails</p>
<p><strong>Cause:</strong> CDC servers are unreliable (common issue)</p>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Re-run the workflow (CDC servers may recover)</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">gh</span> run rerun <span class="op">&lt;</span>run-id<span class="op">&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Or manually trigger for failed datasets only</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="ex">gh</span> workflow run update-nhanes-data.yml <span class="at">-f</span> datasets=<span class="st">"failed_dataset1,failed_dataset2"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="r2-upload-permission-denied">R2 Upload Permission Denied<a class="anchor" aria-label="anchor" href="#r2-upload-permission-denied"></a></h3>
<p><strong>Symptom:</strong> Error during <code>nhanes_pin_write()</code></p>
<p><strong>Cause:</strong> GitHub Secrets not set or R2 token expired</p>
<p><strong>Solution:</strong> 1. Verify secrets exist: Settings â†’ Secrets and variables â†’ Actions 2. Check token expiration in Cloudflare dashboard 3. Rotate token if needed (see SECURITY.md)</p>
</div>
<div class="section level3">
<h3 id="checksum-commit-fails">Checksum Commit Fails<a class="anchor" aria-label="anchor" href="#checksum-commit-fails"></a></h3>
<p><strong>Symptom:</strong> Git push rejected in workflow</p>
<p><strong>Cause:</strong> Branch protection rules blocking bot commits</p>
<p><strong>Solution:</strong> 1. Settings â†’ Branches â†’ Edit branch protection for <code>main</code> 2. Under â€œRestrict who can push to matching branchesâ€, add <code>github-actions[bot]</code> 3. Or temporarily disable branch protection for automated commits</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="chart_with_upwards_trend-monitoring--maintenance">ğŸ“ˆ Monitoring &amp; Maintenance<a class="anchor" aria-label="anchor" href="#chart_with_upwards_trend-monitoring--maintenance"></a></h2>
<div class="section level3">
<h3 id="quarterly-review-checklist">Quarterly Review Checklist<a class="anchor" aria-label="anchor" href="#quarterly-review-checklist"></a></h3>
<p>After each quarterly run:</p>
<ul class="task-list"><li><label><input type="checkbox">Check workflow summary artifact</label></li>
<li><label><input type="checkbox">Verify changed datasets uploaded to R2</label></li>
<li><label><input type="checkbox">Test public access: <code>https://nhanes.kylegrealis.com/demo.parquet</code></label></li>
<li><label><input type="checkbox">Review <code>.checksums.json</code> commit</label></li>
<li><label><input type="checkbox">Check R2 storage usage (Cloudflare dashboard)</label></li>
<li><label><input type="checkbox">Confirm no failed datasets</label></li>
</ul></div>
<div class="section level3">
<h3 id="annual-maintenance">Annual Maintenance<a class="anchor" aria-label="anchor" href="#annual-maintenance"></a></h3>
<ul class="task-list"><li><label><input type="checkbox">Rotate R2 API token</label></li>
<li><label><input type="checkbox">Review and update <code>inst/extdata/datasets.yml</code> (new CDC datasets?)</label></li>
<li><label><input type="checkbox">Check for package dependency updates</label></li>
<li><label><input type="checkbox">Review R2 storage costs</label></li>
<li><label><input type="checkbox">Update SECURITY.md if procedures change</label></li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="mortar_board-learning-resources">ğŸ“ Learning Resources<a class="anchor" aria-label="anchor" href="#mortar_board-learning-resources"></a></h2>
<div class="section level3">
<h3 id="nhanes-data">NHANES Data<a class="anchor" aria-label="anchor" href="#nhanes-data"></a></h3>
<ul><li><a href="https://www.cdc.gov/nchs/nhanes/" class="external-link">CDC NHANES Website</a></li>
<li><a href="https://wwwn.cdc.gov/nchs/nhanes/tutorials/default.aspx" class="external-link">NHANES Tutorials</a></li>
<li><a href="https://cran.r-project.org/package=nhanesA" class="external-link">nhanesA Package Documentation</a></li>
</ul></div>
<div class="section level3">
<h3 id="github-actions">GitHub Actions<a class="anchor" aria-label="anchor" href="#github-actions"></a></h3>
<ul><li><a href="https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions" class="external-link">Workflow Syntax</a></li>
<li><a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" class="external-link">Encrypted Secrets</a></li>
<li><a href="https://cli.github.com/manual/gh_workflow" class="external-link">GitHub CLI</a></li>
</ul></div>
<div class="section level3">
<h3 id="cloudflare-r2">Cloudflare R2<a class="anchor" aria-label="anchor" href="#cloudflare-r2"></a></h3>
<ul><li><a href="https://developers.cloudflare.com/r2/" class="external-link">R2 Documentation</a></li>
<li><a href="https://developers.cloudflare.com/r2/api/s3/tokens/" class="external-link">R2 API Tokens</a></li>
<li><a href="https://developers.cloudflare.com/r2/api/s3/api/" class="external-link">S3 API Compatibility</a></li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="pencil-license--attribution">ğŸ“ License &amp; Attribution<a class="anchor" aria-label="anchor" href="#pencil-license--attribution"></a></h2>
<ul><li>
<strong>NHANES Data:</strong> Public domain (U.S. government)</li>
<li>
<strong>Package Code:</strong> MIT License</li>
<li>
<strong>Automation:</strong> Implemented 2025-01-16</li>
</ul><p>For questions or issues, open a GitHub Issue at: <code>https://github.com/kyleGrealis/nhanesdata/issues</code></p>
<hr><p><strong>Last Updated:</strong> 2025-01-16 <strong>Next Review:</strong> After first quarterly run (2025-04-01)</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://kylegrealis.com" class="external-link">Kyle Grealis</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

